<!DOCTYPE html>
<html lang="en">

<head>
  <title>Survey</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link type="text/css" rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.css" media="screen,projection" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="../public/css/style.css" type="text/css" rel="stylesheet" media="screen,projection" />
  <link href="https://fonts.googleapis.com/css?family=Merienda|Pacifico&display=swap" rel="stylesheet">
  
  <!-- Website Icon -->
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="../images/favicon/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../images/favicon/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../images/favicon/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../images/favicon/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="../images/favicon/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="../images/favicon/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="../images/favicon/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../images/favicon/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="../images/favicon/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="../images/favicon/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="../images/favicon/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="../images/favicon/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="../images/favicon/favicon-128.png" sizes="128x128" />
  <meta name="application-name" content="&nbsp;"/>
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="../images/favicon/mstile-144x144.png" />
  <meta name="msapplication-square70x70logo" content="../images/favicon/mstile-70x70.png" />
  <meta name="msapplication-square150x150logo" content="../images/favicon/mstile-150x150.png" />
  <meta name="msapplication-wide310x150logo" content="../images/favicon/mstile-310x150.png" />
  <meta name="msapplication-square310x310logo" content="../images/favicon/mstile-310x310.png" />
  
</head>

<body>

  <header>
    <!-- Navbar -->
    <nav>
      <div class="nav-wrapper container">
        <a id="logo-container" href="/" class="brand-logo center"><img id="logo" src="../images/web/logo.png"></a>
      </div>
    </nav>
  </header>

  <!-- About -->
  <main>
    <div class="container">
      <div class="section">
        <div class="row">
          <div class="col s12 center">
            <br><br>
            <h4>Friendly Questionnaire</h4>
            <p class="instructions">Please fill out the questionnaire below from your own perspective.</p>
            <p class="instructions">The draggable sliders range from 1 (Unlikely) to 5 (Likely).</p>
            <p class="center light">
              <!-- Name -->
              <div class="row">
                <form class="col s12">
                  <div class="row">
                    <div class="input-field col s4">
                      <textarea id="FirstName" class="materialize-textarea"></textarea>
                      <label for="FirstName">First Name</label>
                    </div>

                    <div class="input-field col s4">
                      <textarea id="LastName" class="materialize-textarea"></textarea>
                      <label for="LastName">Last Name</label>
                    </div>

                    <div class="input-field col s4">
                      <textarea id="Photos" class="materialize-textarea"></textarea>
                      <label for="Photos">Photo URL</label>
                    </div>

                  </div>
                </form>
              </div>

              <div class="center" id="qList"> </div>

              <br><br>
              <a href="/" class="waves-effect waves-light btn-large SurveyBtn Shifting"><i
                  class="material-icons right">home</i>Home</a>
              
            </p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>

    <div class="footer-copyright">
      <div class="container center">
        <!-- <a class="footer-link" href="/api/friends">API Friends List</a> -->
        <a class="footer-link" href="https://www.github.com/esarnb/FriendFinder">Github Repo</a>
      </div>
    </div>
  </footer>
  
   <!-- Modal Structure -->
   <div id="errorModal" class="modal">
     <div class="modal-content">
       <h4>Oops! There are fields that you must answer!</h4>
       <p id="fixThese">ok</p>
     </div>
     <div class="modal-footer">
       <a href="#!" class="modal-close waves-effect waves-green btn-flat">Agree</a>
     </div>
   </div>
  

  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
    crossorigin="anonymous"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.js"></script>

  <script>
    $(document).ready(function () {
      //Initialize all modals
      $('.modal').modal();
      
      
      $(".instructions").show()
      var questions = [
        { q: "Question 1: I do not mind being the center of attention anywhere I go." },
        { q: "Question 2: Before I begin the day, I like to plan out exactly what and when I will be doing my tasks." },
        { q: "Question 3: I become overwhelmed when I attend large events." },
        { q: "Question 4: It is difficult for me to focus in crowded areas." },
        { q: "Question 5: I am afraid to do most things because I am prone to making mistakes."},
        { q: "Question 6: I would tell someone the full truth without any filtering." },
        { q: "Question 7: My mood in the morning determines how my day will be like." },
        { q: "Question 8: I question what most people say until they prove themselves in depth." },
        { q: "Question 9: I like to complete my tasks as soon as I receive them." },
        { q: "Question 10: I can easily control and limit myself from desires." }
      ];

      /*
            Questions, Range Slider,and Submit btn created
      */
      //Iterate through each question to send it to the client
      for (var i = 0; i < questions.length; i++) {
        //1. Append a question to the page
        var prompt = $("<p>"); prompt.text(questions[i].q);
        $("#qList").append(prompt)

        //Setup for the Range Slider under each Question
        var labelTag = $("<label>");
        labelTag.attr("for", `Q${i + 1}`);
        labelTag.text("(0)")

        var inputTag = $("<input>");
        inputTag.addClass("sliderVals");
        inputTag.attr("type", "range");
        inputTag.attr("id", `Q${i + 1}`);
        inputTag.attr("min", "0");
        inputTag.attr("max", "5");
        inputTag.attr("value", "0");

        var pTag = $("<p>");
        pTag.addClass("range-field");

        var formTag = $("<form>");
        formTag.attr("action", "#");

        var divTag = $("<div>");
        divTag.addClass("container formQuestions center");

        //2. Append slider under the question prompt
        pTag.append(inputTag);
        pTag.append(labelTag);
        formTag.append(pTag);
        divTag.append(formTag);
        $("#qList").append(divTag);

      }

      var submitBtn = $("<button>");
      submitBtn.addClass("btn waves-effect waves-light");
      submitBtn.attr("type", "submit");
      submitBtn.attr("name", "action");
      submitBtn.attr("id", "submitBtn");
      submitBtn.text("Submit");
      submitBtn.append(`<i class="material-icons right">send</i>`);
      $("#qList").append(submitBtn);

      /*
            Listeners
      */

      //When the slider changes, update the text below it
      $('.sliderVals').on('change input', function () {
        $(this).attr("value", $(this).val()) //updates get-value
        $(this).siblings('label').html(`(${$(this).val()})`); //updates label
      });
      
      //Submit Button Listener
      $(document).on('click', '#submitBtn', function () {
        event.preventDefault();
        var errorModal = $(".modal");
        var fixThese = $("#fixThese");
        var unanswered = [];
        var answered = [];

        //Log all unanswered questions, else log all answered values
        $('.sliderVals').filter(function () {
          if ($(this).val() == "0") unanswered.push($(this).attr("id"))
          else answered.push($(this).val());
        });

        //Prompt user to answer the unanswered questions.
        if (unanswered.length > 0) {
          fixThese.text("Please answer Questions: " + unanswered.join(", "))
          $('#errorModal').modal("open");
        }
        //If the name fields are blank, prompt user to fill them in
        else if (!$("#FirstName").val() || !$("#LastName").val()) {
          fixThese.text("Please fill in your first & last name!")
          $('#errorModal').modal("open");
        }
        else {
          //Initialize loading bar.
        $("#qList").append(`<div class="progress"><div class="indeterminate"></div></div>`)

          var userPhoto = $("#Photos").val().trim();
          //Send data from form to server, with a default "No Photo" picture if needed
          $.post("/api/friends", {
            name: `${$("#FirstName").val().trim()} ${$("#LastName").val().trim()}`,
            photo: userPhoto ? userPhoto : userPhoto = "https://pbs.twimg.com/profile_images/961238719268257792/QAE3SnEi_400x400.jpg",
            survey: answered
          }, function(matches) {

            //Clear All Q & A's to make room for potential matches. 
            $("#qList").empty(); 
            $(".instructions").hide()

            //Potential Matches Title
            $("#qList").append(`<h3> Your Potential Matches: </h3>`)

            //Append all matches into Rows and Columns
            var rowTag = $("<div>");
              rowTag.addClass("row");
              var ulTag = $("<ul>");
              
              //Each match will print a profile pic and name.
              for (eachPerson of matches) {
                var colTag = $("<div>"); colTag.addClass("col s12 m6 l6 xl4");
                colTag.append(`
                <li class="collection-item avatar">
                <span class="title">
                  <img src="${eachPerson.photo}" alt="" class="circle" width="50" height="50">
                  <p>${eachPerson.name}</p>
                </span></li>`)

                ulTag.append(colTag)
              }
              rowTag.append(ulTag)
              $("#qList").append(rowTag)
          })
        }
      })
    })
  </script>
</body>

</html>